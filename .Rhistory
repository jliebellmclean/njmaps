# Calculate the percent of Democrat and Republican votes and partisan lean
gov2 <- gov |>
mutate(pct_dem = democratic_raw_votes/gov_raw_county_vote_totals_two_party,
pct_rep = republican_raw_votes/gov_raw_county_vote_totals_two_party,
d_points = pct_dem - pct_rep)|>
# Drop everything except the lean, county ID, and the election years
select(election_year, fips, d_points) |>
# Rename the fips code for merging
rename(GEOID = fips)
# Isolate the geometry and fips code
geo <- county |>
select(GEOID, geometry)
# Add on the geometry to the election results
gov2 <- gov2 %>%
left_join(geo, by = "GEOID")
# Add in information from 2021 and 2025
# I pulled information from the NJ state website:
# https://www.nj.gov/state/elections/election-night-results.shtml
# For 2025, I was redirected to the County Clerk websites for all counties
# I pulled that information
# I then corroborated the numbers against the AP's reported results. They match
gov_updated <- read.csv("data/updated_gov.csv")
# Rename the name category
gov_updated <- gov_updated |>
rename(NAME = county)
# Isolate the county names and fips codes
county_code <- county |>
select(GEOID, NAME) |>
# Merge the GEOIDs onto the new election results
gov_updated <- gov_updated %>%
left_join(county_code, by = "NAME")
source("~/GitHub/project ideas.R", echo = TRUE)
gov_updated <- gov_updated %>%
left_join(county_code, by = "NAME")
colnames(gov2)
# Make sure that the column names will match in the updated gov
gov_updated <- gov_updated |>
# Rename election year
rename(election_year = year) |>
mutate(
# Create a totals column
total = d_votes + r_votes,
# Calculate Democratic and Republican vote percentages
pct_dem = d_votes/total,
pct_rep = r_votes/total,
# Calculate lean
d_points = pct_dem - pct_rep)
# Drop everything except the lean, county ID, and the election years
gov_updated <- gov_updated |>
select(election_year, GEOID, d_points, geometry)
# Bind the newer gubernatorial data onto the older data
gov3 <- rbind(gov2, gov_updated)
# Graph the partisan lean in a given year, by county, for NJ
p <- ggplot(gov3, aes(fill = d_points, geometry = geometry)) +
geom_sf(color = "grey2", linewidth = 0.05) +
scale_fill_gradient2(
low = "#CB454A", mid = "white", high = "#2E74C0",
midpoint = 0,
name = "Partisan Lean"
) +
facet_wrap(~ election_year, ncol = 3) +
labs(title = "Partisan Lean in Gubernatorial Elections, 2005â€“2025") +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank()
)
p
ggsave("figures/gov.png", plot = p, dpi = 300)
gov_updated <- read.csv("data/updated_gov.csv")
rename(NAME = county)
try <- map2 |>
mutate(
dem_change = pct_dem_2025 - pct_dem_2021,
rep_change = pct_rep_2025 - pct_rep_2021,
# Calculate shift towards democrats -- positive will indicate dem shift
shift = dem_change - rep_change
)
View(senate1)
View(county)
try <- map2 |>
mutate(
dem_change = pct_dem_2025 - pct_dem_2021,
rep_change = pct_rep_2025 - pct_rep_2021,
# Calculate shift towards democrats -- positive will indicate dem shift
shift = 100*(dem_change - rep_change)
)
try <- map2 |>
mutate(
dem_change = pct_dem_2025 - pct_dem_2021,
rep_change = pct_rep_2025 - pct_rep_2021,
# Calculate shift towards democrats -- positive will indicate dem shift
shift = round(100*(dem_change - rep_change),2)
)
try <- map2 |>
mutate(
dem_change = pct_dem_2025 - pct_dem_2021,
rep_change = pct_rep_2025 - pct_rep_2021,
# Calculate shift towards democrats -- positive will indicate dem shift
shift = round(100*(dem_change - rep_change),1)
)
map2 <- map2 |>
mutate(
dem_change = pct_dem_2025 - pct_dem_2021,
rep_change = pct_rep_2025 - pct_rep_2021,
# Calculate shift towards democrats -- positive will indicate dem shift
shift = round(100*(dem_change - rep_change),1)
)
# Cull it to just the things we want to graph
map2 <- map2 |>
select(geomtery, shift)
map2 <- map2 |>
select(geometry, shift)
p <- ggplot() +
# Add county outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add a dot at the county centers
geom_sf(data = county_centers, aes(color = "#2E75C9", size = shift), shape = 17) +
scale_size_continuous(
range = c(5, 17),   # adjust min/max dot size
name = "Margin Shift"
) +
labs(title = "Margin Shift") +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank()
)
p
map2 <- st_as_sf(map2)
county_centers <- st_centroid(map2)
# Add layers
p <- ggplot() +
# Add county outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add a dot at the county centers
geom_sf(data = county_centers, aes(color = "#2E75C9", size = shift), shape = 17) +
scale_size_continuous(
range = c(5, 17),   # adjust min/max dot size
name = "Margin Shift"
) +
labs(title = "Margin Shift") +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank()
)
p
scaling_factor <- 1
arrows_df <- county_centers |>
mutate(
X = st_coordinates(geometry)[,1],
Y = st_coordinates(geometry)[,2],
shift_height = margin_shift / scaling_factor,  # scale to fit map
Yend = Y + shift_height
)
arrows_df <- county_centers |>
mutate(
X = st_coordinates(geometry)[,1],
Y = st_coordinates(geometry)[,2],
shift_height = shift / scaling_factor,  # scale to fit map
Yend = Y + shift_height
)
p <- ggplot() +
# County outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add the arrows
geom_segment(data = arrows_df,
aes(x = X, y = Y, xend = X, yend = Yend, color = margin_shift),
arrow = arrow(length = unit(0.15, "cm")),
linewidth = 1.2)
p
p <- ggplot() +
# County outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add the arrows
geom_segment(data = arrows_df,
aes(x = X, y = Y, xend = X, yend = Yend),
arrow = arrow(length = unit(0.15, "cm")),
linewidth = 1.2)
p
scaling_factor <- 5
# Create a data frame of arrow segments
arrows_df <- county_centers |>
mutate(
X = st_coordinates(geometry)[,1],
Y = st_coordinates(geometry)[,2],
shift_height = shift / scaling_factor,  # scale to fit map
Yend = Y + shift_height
)
# Plot with arrows
p <- ggplot() +
# County outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add the arrows
geom_segment(data = arrows_df,
aes(x = X, y = Y, xend = X, yend = Yend),
arrow = arrow(length = unit(0.15, "cm")),
linewidth = 1.2)
p
scaling_factor <- 50
# Create a data frame of arrow segments
arrows_df <- county_centers |>
mutate(
X = st_coordinates(geometry)[,1],
Y = st_coordinates(geometry)[,2],
shift_height = shift / scaling_factor,  # scale to fit map
Yend = Y + shift_height
)
# Plot with arrows
p <- ggplot() +
# County outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add the arrows
geom_segment(data = arrows_df,
aes(x = X, y = Y, xend = X, yend = Yend),
arrow = arrow(length = unit(0.15, "cm")),
linewidth = 1.2)
p
p <- ggplot() +
# County outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add the arrows
geom_segment(data = arrows_df,
color = "#2E75C9",
aes(x = X, y = Y, xend = X, yend = Yend),
arrow = arrow(length = unit(0.15, "cm")),
linewidth = 1.2) +
theme_minimal() +
theme(axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank())
p
View(arrows_df)
p <- ggplot() +
# County outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add the arrows
geom_segment(data = arrows_df,
color = shift,
aes(x = X, y = Y, xend = X, yend = Yend),
arrow = arrow(length = unit(0.15, "cm")),
linewidth = 1.2) +
scale_color_gradient2(low = "#CC5E73", mid = "white", high = "#2E75C9", midpoint = 0) +
theme_minimal() +
theme(axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank())
p <- ggplot() +
# County outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add the arrows
geom_segment(data = arrows_df,
aes(x = X, y = Y, xend = X, yend = Yend, color = shift),
arrow = arrow(length = unit(0.15, "cm")),
linewidth = 1.2) +
scale_color_gradient2(low = "#CC5E73", mid = "white", high = "#2E75C9", midpoint = 0) +
theme_minimal() +
theme(axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank())
p
arrows_df <- county_centers |>
mutate(
X = st_coordinates(geometry)[,1],
Y = st_coordinates(geometry)[,2],
shift_height = shift / scaling_factor,  # scale to fit map
Yend = Y + shift_height,
arrow_color = ifelse(shift >= 0, "#2E75C9", "#CC5E73")
)
# Plot with arrows
p <- ggplot() +
# County outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add the arrows
geom_segment(data = arrows_df,
aes(x = X, y = Y, xend = X, yend = Yend, color = arrow_color),
arrow = arrow(length = unit(0.15, "cm")),
linewidth = 1.2) +
scale_color_identity +
theme_minimal() +
theme(axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank())
arrows_df <- county_centers |>
mutate(
X = st_coordinates(geometry)[,1],
Y = st_coordinates(geometry)[,2],
shift_height = shift / scaling_factor,  # scale to fit map
Yend = Y + shift_height,
arrow_color = ifelse(shift >= 0, "#2E75C9", "#CC5E73")
)
# Plot with arrows
p <- ggplot() +
# County outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add the arrows
geom_segment(data = arrows_df,
aes(x = X, y = Y, xend = X, yend = Yend, color = arrow_color),
arrow = arrow(length = unit(0.15, "cm")),
linewidth = 1.2)
p
arrows_df <- county_centers |>
mutate(
X = st_coordinates(geometry)[,1],
Y = st_coordinates(geometry)[,2],
shift_height = shift / scaling_factor,  # scale to fit map
Yend = Y + shift_height,
arrow_color = ifelse(shift >= 0, "#2E75C9", "#CC5E73")
)
# Plot with arrows
p <- ggplot() +
# County outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add the arrows
geom_segment(data = arrows_df,
aes(x = X, y = Y, xend = X, yend = Yend, color = arrow_color),
arrow = arrow(length = unit(0.15, "cm")),
linewidth = 1.2) +
scale_color_identity() +
theme_minimal() +
theme(axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank())
p
p <- ggplot() +
# County outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add the arrows
geom_segment(data = arrows_df,
aes(x = X, y = Y, xend = X, yend = Yend, color = arrow_color),
linewidth = 1.2) +
scale_color_identity() +
theme_minimal() +
theme(axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank())
p
p <- ggplot() +
# County outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add the arrows
# geom_segment(data = arrows_df,
# aes(x = X, y = Y, xend = X, yend = Yend, color = arrow_color),
#arrow = arrow(length = unit(0.15, "cm")),
#linewidth = 1.2) +
geom_point(
data = arrows_df,
aes(x = X, y = Yend, color = arrow_color, size = abs(shift)),
shape = 17   # triangle point shape
) +
scale_color_identity() +
theme_minimal() +
theme(axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank())
p
p <- ggplot() +
# County outlines
geom_sf(data = map2, fill = NA, color = "grey2", linewidth = 0.05) +
# Add the arrows
geom_segment(data = arrows_df,
aes(x = X, y = Y, xend = X, yend = Yend, color = arrow_color),
arrow = arrow(length = unit(0.15, "cm")),
linewidth = 1.2) +
scale_color_identity() +
theme_minimal() +
theme(axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank())
p
p1 <- p +
geom_point(data = cities_sf, aes(x = X, y = Y, shape = city), color = "grey2", size = 2) +
geom_text(data = cities_sf,
aes(x = X, y = Y, label = city),
nudge_y = -0.07,
fontface = "bold",
size = 3) +
scale_shape_manual(values = c("Newark" = 15, "Trenton" = 8)) +
theme(panel.grid = element_blank())
p1
p1 <- p +
geom_point(data = cities_sf, aes(x = X, y = Y, shape = city), color = "grey2", size = 2) +
geom_text(data = cities_sf,
aes(x = X, y = Y, label = city),
nudge_y = -0.07,
fontface = "bold",
size = 3) +
scale_shape_manual(values = c("Newark" = 15, "Trenton" = 8)) +
theme(panel.grid = element_blank(),
legend.position = "none") +
labs(title = "Margin Shift") +
p1
p1 <- p +
geom_point(data = cities_sf, aes(x = X, y = Y, shape = city), color = "grey2", size = 2) +
geom_text(data = cities_sf,
aes(x = X, y = Y, label = city),
nudge_y = -0.07,
fontface = "bold",
size = 3) +
scale_shape_manual(values = c("Newark" = 15, "Trenton" = 8)) +
theme(panel.grid = element_blank(),
legend.position = "none") +
labs(title = "Margin Shift")
p1
ggsave("figures/2025marginshift.png", plot = p1, dpi = 300)
View(try)
gov_updated <- read.csv("data/updated_gov.csv")
# Rename the name category
gov_updated <- gov_updated |>
rename(NAME = county)
# Calculate the percent of Democrat and Republican votes and partisan lean
gov <- gov_updated |>
mutate(totals_two_party = d_votes + r_votes,
pct_dem = d_votes/totals_two_party,
pct_rep = r_votes/totals_two_party,
d_points = pct_dem - pct_rep)
# Read in the county shapefile data which is available from the Census (or the class drive)
county_all <- st_read("data/cb_2024_us_county_500k.shp")
# Filter to just New Jersey
geo <- county_all |>
filter(STATEFP == 34) |>
# Isolate the geometry, name and fips code
select(GEOID, geometry, NAME)
# Add on the geometry to the election results
gov2 <- gov %>%
left_join(geo, by = "NAME")
# Create the data set for ballot totals
map1 <- gov2 |>
filter(year == 2025) |>
select(totals_two_party, d_points, GEOID, geometry)
# Begin to graph the 2025 ballot count map from the AP
# Compute centroids of each county
map1 <- st_as_sf(map1)
county_centers <- st_centroid(map1)
p <- ggplot() +
# County outlines
geom_sf(data = map1, fill = NA, color = "grey2", linewidth = 0.05) +
# Add a dot at the county centers
geom_sf(data = county_centers, aes(color = d_points, size = totals_two_party), shape = 20) +
scale_color_gradient2(
low = "#D43D5A", mid = "white", high = "#2E75C9",
midpoint = 0,
name = "Partisan Lean"
) +
scale_size_continuous(
range = c(5, 17),   # adjust min/max dot size
name = "Ballots Counted"
) +
labs(title = "Ballots Counted") +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank()
)
p
# The AP map also has two major cities
# Pull city coordinates
cities <- data.frame(
city = c("Newark", "Trenton"),
lon  = c(-74.1724, -74.7670),
lat  = c(40.7357, 40.2171)
)
# Convert to an sf object
cities_sf <- st_as_sf(cities, coords = c("lon", "lat"), crs = 4326)
# Make sure the projections match
cities_sf <- st_transform(cities_sf, st_crs(map1))
cities_coords <- st_coordinates(cities_sf)
cities_sf$X <- cities_coords[,1]
cities_sf$Y <- cities_coords[,2]
# add the cities to the map
p1 <- p +
geom_point(data = cities_sf, aes(x = X, y = Y, shape = city), color = "grey2", size = 2) +
geom_text(data = cities_sf,
aes(x = X, y = Y, label = city),
nudge_y = -0.07,
fontface = "bold",
size = 3) +
scale_shape_manual(values = c("Newark" = 15, "Trenton" = 8))
p1
# Save the figure
ggsave("figures/2025ballotcount.png", plot = p1, dpi = 300)
p1 <- p +
geom_point(data = cities_sf, aes(x = X, y = Y, shape = city), color = "grey2", size = 2) +
geom_text(data = cities_sf,
aes(x = X, y = Y, label = city),
nudge_y = -0.07,
fontface = "bold",
size = 3) +
scale_shape_manual(values = c("Newark" = 15, "Trenton" = 8)) +
guides(shape = "none") +
p1
p1 <- p +
geom_point(data = cities_sf, aes(x = X, y = Y, shape = city), color = "grey2", size = 2) +
geom_text(data = cities_sf,
aes(x = X, y = Y, label = city),
nudge_y = -0.07,
fontface = "bold",
size = 3) +
scale_shape_manual(values = c("Newark" = 15, "Trenton" = 8)) +
guides(shape = "none")
p1
ggsave("figures/2025ballotcount.png", plot = p1, dpi = 300)
setwd("C:\\Users\\julia\\OneDrive\\Documents\\GitHub\\njmaps")
# Read in the county shapefile data which is available from the Census (or the class drive)
county_all <- st_read("data/cb_2024_us_county_500k.shp")
# Filter to just New Jersey
county <- county_all |>
filter(STATEFP == 34)
# Load 2020 population for NJ counties, without geometry
census <- get_decennial(
geography = "county",
variables = "P1_001N",   # total population
state = "NJ",
year = 2020,
geometry = FALSE
)
#Look at the data
census
View(census)
